from unittest import mock, TestCase, main
from main import describe_instances_paginated, get_all_aws_instances
import datetime
from dateutil.tz import tzutc


class TestMain(TestCase):

    def return_responses_one_by_one(self, *args, **kwargs):
        return self.response_list.pop(0)

    @mock.patch('boto3.client')
    def test_describe_instances_paginated(self, client):
        """
        The test checks that the function keep pulling the instances until a response without NextToken
        is received and returns the correct instances from those responses.
        """
        # Example for a response CONTAINING a NextToken key
        first_response = {'Reservations': [{'Groups': [], 'Instances': [{'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'AttachmentId': 'eni-attach-07f380aa1652462f8', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'Ipv6Addresses': [], 'MacAddress': '0a:a1:88:c0:28:64', 'NetworkInterfaceId': 'eni-01346a357c542ed94', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28)}], 'OwnerId': '924736140882', 'ReservationId': 'r-020e78b1161b80b19'}], 'ResponseMetadata': {'RequestId': '8ab82373-329d-457c-b16f-32c750e3124a', 'HTTPStatusCode': 200, 'HTTPHeaders': {'x-amzn-requestid': '8ab82373-329d-457c-b16f-32c750e3124a', 'cache-control': 'no-cache, no-store', 'strict-transport-security': 'max-age=31536000; includeSubDomains', 'vary': 'accept-encoding', 'content-type': 'text/xml;charset=UTF-8', 'transfer-encoding': 'chunked', 'date': 'Sat, 27 Nov 2021 20:02:29 GMT', 'server': 'AmazonEC2'}, 'RetryAttempts': 0}, 'NextToken': 'random_token'}

        # Example for a response that does not contain a NextToken key
        second_response = {'Reservations': [{'Groups': [], 'Instances': [{'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'AttachmentId': 'eni-attach-07f380aa1652462f8', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'Ipv6Addresses': [], 'MacAddress': '0a:a1:88:c0:28:64', 'NetworkInterfaceId': 'eni-01346a357c542ed94', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28)}], 'OwnerId': '924736140882', 'ReservationId': 'r-020e78b1161b80b19'}], 'ResponseMetadata': {'RequestId': '8ab82373-329d-457c-b16f-32c750e3124a', 'HTTPStatusCode': 200, 'HTTPHeaders': {'x-amzn-requestid': '8ab82373-329d-457c-b16f-32c750e3124a', 'cache-control': 'no-cache, no-store', 'strict-transport-security': 'max-age=31536000; includeSubDomains', 'vary': 'accept-encoding', 'content-type': 'text/xml;charset=UTF-8', 'transfer-encoding': 'chunked', 'date': 'Sat, 27 Nov 2021 20:02:29 GMT', 'server': 'AmazonEC2'}, 'RetryAttempts': 0}}

        # Empty response. should not be called by the tested func because the second response does'nt have a NextToken.
        empty_response = {}

        self.response_list = [first_response, second_response, empty_response]
        client.describe_instances.side_effect = self.return_responses_one_by_one
        instances = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'AttachmentId': 'eni-attach-07f380aa1652462f8', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'Ipv6Addresses': [], 'MacAddress': '0a:a1:88:c0:28:64', 'NetworkInterfaceId': 'eni-01346a357c542ed94', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28)}, {'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 28), 'AttachmentId': 'eni-attach-07f380aa1652462f8', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'Ipv6Addresses': [], 'MacAddress': '0a:a1:88:c0:28:64', 'NetworkInterfaceId': 'eni-01346a357c542ed94', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28)}]
        self.assertEqual(describe_instances_paginated(client), instances)

    @mock.patch('boto3.client')
    @mock.patch('main.describe_instances_paginated')
    def test_get_all_aws_instances_iter_over_regions(self, regions_instances, client):
        """
        Checks that the the function iterate over all regions by the list.
        """
        all_aws_regions = ["us-east-2", "us-east-1", "us-west-1", "us-west-2", "af-south-1", "ap-east-1", "ap-south-1",
                           "ap-northeast-3", "ap-northeast-2", "ap-southeast-1", "ap-southeast-2", "ap-northeast-1",
                           "ca-central-1", "eu-central-1", "eu-west-1", "eu-west-2", "eu-south-1", "eu-west-3",
                           "eu-north-1", "me-south-1", "sa-east-1"]

        get_all_aws_instances()

        # Generate the expected calls to the client method with the expected regions as arguments.
        calls = [mock.call('ec2', region_name=region) for region in all_aws_regions]

        client.assert_has_calls(calls, any_order=False)

    @mock.patch('boto3.client')
    @mock.patch('main.describe_instances_paginated')
    def test_get_all_aws_instances_general(self, regions_instances, client):
        """
        Test 1
        The test checks the run of the function with a valid input, given that describe_instances_paginated func works.
        This test checks for a situation where specifically 2 regions are being pulled from.
        """
        # Expected return of "the the get_all_aws_instances" function in a string format.
        expected_instances = "[Instance(image_id='ami-0d718c3d715cec4a7', instance_id='i-0e8bdd2ac54738254', network_interfaces=[NetworkInterface(ip_owner_id='amazon', public_dns_name='ec2-18-217-63-24.us-east-2.compute.amazonaws.com', mac_address='0a:a1:88:c0:28:64', network_interface_id='eni-01346a357c542ed94', owner_id='924736140882', private_dns_name='ip-172-31-37-32.us-east-2.compute.internal', subnet_id='subnet-6fd65e23', status='in-use', public_ip_address=IPv4Address('18.217.63.24'), ipv6_address=None, private_ip_address=IPv4Address('172.31.37.32'))], state={'Code': 16, 'Name': 'running'}, launch_time=datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), tags=[{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], cpu_details={'CoreCount': 1, 'ThreadsPerCore': 1}, instance_type='t2.micro', security_groups=[{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], client_token='', state_transition_reason='', root_device_name='/dev/xvda', ram_disk_id='', platform='Linux/UNIX', kernel_id='', Host_id=''), Instance(image_id='ami-00be885d550dcee43', instance_id='i-0ea170c53ee0dc00f', network_interfaces=[NetworkInterface(ip_owner_id='amazon', public_dns_name='ec2-54-203-101-239.us-west-2.compute.amazonaws.com', mac_address='02:45:a1:7d:57:fb', network_interface_id='eni-01091630dd6711e2a', owner_id='924736140882', private_dns_name='ip-172-31-29-99.us-west-2.compute.internal', subnet_id='subnet-ffd03887', status='in-use', public_ip_address=IPv4Address('54.203.101.239'), ipv6_address=None, private_ip_address=IPv4Address('172.31.29.99'))], state={'Code': 16, 'Name': 'running'}, launch_time=datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), tags=[{'Key': 'Candidate-oregon', 'Value': ''}, {'Key': 'Name', 'Value': 'candidate test 2'}], cpu_details={'CoreCount': 1, 'ThreadsPerCore': 1}, instance_type='t2.micro', security_groups=[{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], client_token='', state_transition_reason='', root_device_name='/dev/xvda', ram_disk_id='', platform='Linux/UNIX', kernel_id='', Host_id='')]"

        # Expected return of the "describe_instances_paginated" from region "us-east-2"
        first_instance = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29, tzinfo=tzutc()), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), 'AttachmentId': 'eni-attach-07f380aa1652462f8', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'Ipv6Addresses': [], 'MacAddress': '0a:a1:88:c0:28:64', 'NetworkInterfaceId': 'eni-01346a357c542ed94', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.24'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc())}]

        # Expected return of the "describe_instances_paginated" from region "us-west-2"
        second_instance = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-00be885d550dcee43', 'InstanceId': 'i-0ea170c53ee0dc00f', 'InstanceType': 't2.micro', 'KeyName': 'Candidate-origon', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-west-2b', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.99', 'ProductCodes': [], 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIpAddress': '54.203.101.239', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-ffd03887', 'VpcId': 'vpc-9a6bf4e2', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 51, 23, tzinfo=tzutc()), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-0afce151ad47c0f74'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIp': '54.203.101.239'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), 'AttachmentId': 'eni-attach-08055879c4db0066b', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], 'Ipv6Addresses': [], 'MacAddress': '02:45:a1:7d:57:fb', 'NetworkInterfaceId': 'eni-01091630dd6711e2a', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.99', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIp': '54.203.101.239'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.99'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-ffd03887', 'VpcId': 'vpc-9a6bf4e2', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Candidate-oregon', 'Value': ''}, {'Key': 'Name', 'Value': 'candidate test 2'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc())}]

        self.response_list = [first_instance, second_instance]

        # Direct calls for "describe_instances_paginated" into "return_responses_one_by_one" method.
        # relevant for all tests in this function.
        regions_instances.side_effect = self.return_responses_one_by_one

        active_regions = ["us-east-2", "us-west-2"]
        self.assertEqual(str(get_all_aws_instances(specific_regions=active_regions)), expected_instances)

        """
        Test 2
        The test checks the run of the function with an empty network interfaces.
        In the returned instances the network interfaces should be empty.
        """
        # Expected return of "the the get_all_aws_instances" function in a string format.
        expected_instances = "[Instance(image_id='ami-0d718c3d715cec4a7', instance_id='i-0e8bdd2ac54738254', network_interfaces=[], state={'Code': 16, 'Name': 'running'}, launch_time=datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), tags=[{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], cpu_details={'CoreCount': 1, 'ThreadsPerCore': 1}, instance_type='t2.micro', security_groups=[{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], client_token='', state_transition_reason='', root_device_name='/dev/xvda', ram_disk_id='', platform='Linux/UNIX', kernel_id='', Host_id=''), Instance(image_id='ami-00be885d550dcee43', instance_id='i-0ea170c53ee0dc00f', network_interfaces=[], state={'Code': 16, 'Name': 'running'}, launch_time=datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), tags=[{'Key': 'Candidate-oregon', 'Value': ''}, {'Key': 'Name', 'Value': 'candidate test 2'}], cpu_details={'CoreCount': 1, 'ThreadsPerCore': 1}, instance_type='t2.micro', security_groups=[{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], client_token='', state_transition_reason='', root_device_name='/dev/xvda', ram_disk_id='', platform='Linux/UNIX', kernel_id='', Host_id='')]"

        # Examples of expected returns from "describe_instances_paginated" that the "NetworkInterfaces" field is empty.
        first_instance = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29, tzinfo=tzutc()), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc())}]
        second_instance = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-00be885d550dcee43', 'InstanceId': 'i-0ea170c53ee0dc00f', 'InstanceType': 't2.micro', 'KeyName': 'Candidate-origon', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-west-2b', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.99', 'ProductCodes': [], 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIpAddress': '54.203.101.239', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-ffd03887', 'VpcId': 'vpc-9a6bf4e2', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 51, 23, tzinfo=tzutc()), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-0afce151ad47c0f74'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Candidate-oregon', 'Value': ''}, {'Key': 'Name', 'Value': 'candidate test 2'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc())}]

        self.response_list = [first_instance, second_instance]
        self.assertEqual(str(get_all_aws_instances(specific_regions=active_regions)), expected_instances)

        """
        Test 3
        The test checks input with invalid ip addresses.
        In the returned instances, inside the network interfaces, the invalid ip addresses's' fields should be empty.
        """
        # Expected return of "the the get_all_aws_instances" function in a string format.
        expected_instances = "[Instance(image_id='ami-0d718c3d715cec4a7', instance_id='i-0e8bdd2ac54738254', network_interfaces=[NetworkInterface(ip_owner_id='amazon', public_dns_name='ec2-18-217-63-24.us-east-2.compute.amazonaws.com', mac_address='0a:a1:88:c0:28:64', network_interface_id='eni-01346a357c542ed94', owner_id='924736140882', private_dns_name='ip-172-31-37-32.us-east-2.compute.internal', subnet_id='subnet-6fd65e23', status='in-use', public_ip_address=None, ipv6_address=None, private_ip_address=None)], state={'Code': 16, 'Name': 'running'}, launch_time=datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), tags=[{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], cpu_details={'CoreCount': 1, 'ThreadsPerCore': 1}, instance_type='t2.micro', security_groups=[{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], client_token='', state_transition_reason='', root_device_name='/dev/xvda', ram_disk_id='', platform='Linux/UNIX', kernel_id='', Host_id=''), Instance(image_id='ami-00be885d550dcee43', instance_id='i-0ea170c53ee0dc00f', network_interfaces=[NetworkInterface(ip_owner_id='amazon', public_dns_name='ec2-54-203-101-239.us-west-2.compute.amazonaws.com', mac_address='02:45:a1:7d:57:fb', network_interface_id='eni-01091630dd6711e2a', owner_id='924736140882', private_dns_name='ip-172-31-29-99.us-west-2.compute.internal', subnet_id='subnet-ffd03887', status='in-use', public_ip_address=None, ipv6_address=None, private_ip_address=None)], state={'Code': 16, 'Name': 'running'}, launch_time=datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), tags=[{'Key': 'Candidate-oregon', 'Value': ''}, {'Key': 'Name', 'Value': 'candidate test 2'}], cpu_details={'CoreCount': 1, 'ThreadsPerCore': 1}, instance_type='t2.micro', security_groups=[{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], client_token='', state_transition_reason='', root_device_name='/dev/xvda', ram_disk_id='', platform='Linux/UNIX', kernel_id='', Host_id='')]"

        # Examples of expected returns from "describe_instances_paginated" with invalid ip addresses.
        first_instance = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-0d718c3d715cec4a7', 'InstanceId': 'i-0e8bdd2ac54738254', 'InstanceType': 't2.micro', 'KeyName': 'dev_Candidate', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-east-2c', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32', 'ProductCodes': [], 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIpAddress': '18.217.63.24', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 29, tzinfo=tzutc()), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-071794c2527107b66'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.2217.63.256'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc()), 'AttachmentId': 'eni-attach-07f380aa1652462f8', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'Ipv6Addresses': [], 'MacAddress': '0a:a1:88:c0:28:64', 'NetworkInterfaceId': 'eni-01346a357c542ed94', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '172.31.37.32.1', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-18-217-63-24.us-east-2.compute.amazonaws.com', 'PublicIp': '18.217.63.'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-37-32.us-east-2.compute.internal', 'PrivateIpAddress': '132.3c1.37.32.'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-6fd65e23', 'VpcId': 'vpc-c6de1dad', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-0fecf864e5181d0f6'}, {'GroupName': 'default', 'GroupId': 'sg-c7de64a0'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Name', 'Value': 'Candidate test instance 1'}, {'Key': 'dev', 'Value': ''}, {'Key': 'ziv', 'Value': '123'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 46, 28, tzinfo=tzutc())}]
        second_instance = [{'AmiLaunchIndex': 0, 'ImageId': 'ami-00be885d550dcee43', 'InstanceId': 'i-0ea170c53ee0dc00f', 'InstanceType': 't2.micro', 'KeyName': 'Candidate-origon', 'LaunchTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), 'Monitoring': {'State': 'disabled'}, 'Placement': {'AvailabilityZone': 'us-west-2b', 'GroupName': '', 'Tenancy': 'default'}, 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.99', 'ProductCodes': [], 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIpAddress': '54.203.101.239', 'State': {'Code': 16, 'Name': 'running'}, 'StateTransitionReason': '', 'SubnetId': 'subnet-ffd03887', 'VpcId': 'vpc-9a6bf4e2', 'Architecture': 'x86_64', 'BlockDeviceMappings': [{'DeviceName': '/dev/xvda', 'Ebs': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 51, 23, tzinfo=tzutc()), 'DeleteOnTermination': True, 'Status': 'attached', 'VolumeId': 'vol-0afce151ad47c0f74'}}], 'ClientToken': '', 'EbsOptimized': False, 'EnaSupport': True, 'Hypervisor': 'xen', 'NetworkInterfaces': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIp': '54.20c3.101.239'}, 'Attachment': {'AttachTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc()), 'AttachmentId': 'eni-attach-08055879c4db0066b', 'DeleteOnTermination': True, 'DeviceIndex': 0, 'Status': 'attached', 'NetworkCardIndex': 0}, 'Description': '', 'Groups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], 'Ipv6Addresses': [], 'MacAddress': '02:45:a1:7d:57:fb', 'NetworkInterfaceId': 'eni-01091630dd6711e2a', 'OwnerId': '924736140882', 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.9c9', 'PrivateIpAddresses': [{'Association': {'IpOwnerId': 'amazon', 'PublicDnsName': 'ec2-54-203-101-239.us-west-2.compute.amazonaws.com', 'PublicIp': '54.2c03.101.239'}, 'Primary': True, 'PrivateDnsName': 'ip-172-31-29-99.us-west-2.compute.internal', 'PrivateIpAddress': '172.31.29.989'}], 'SourceDestCheck': True, 'Status': 'in-use', 'SubnetId': 'subnet-ffd03887', 'VpcId': 'vpc-9a6bf4e2', 'InterfaceType': 'interface'}], 'RootDeviceName': '/dev/xvda', 'RootDeviceType': 'ebs', 'SecurityGroups': [{'GroupName': 'launch-wizard-1', 'GroupId': 'sg-07ae7734813859bb4'}], 'SourceDestCheck': True, 'Tags': [{'Key': 'Candidate-oregon', 'Value': ''}, {'Key': 'Name', 'Value': 'candidate test 2'}], 'VirtualizationType': 'hvm', 'CpuOptions': {'CoreCount': 1, 'ThreadsPerCore': 1}, 'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'}, 'HibernationOptions': {'Configured': False}, 'MetadataOptions': {'State': 'applied', 'HttpTokens': 'optional', 'HttpPutResponseHopLimit': 1, 'HttpEndpoint': 'enabled', 'HttpProtocolIpv6': 'disabled'}, 'EnclaveOptions': {'Enabled': False}, 'PlatformDetails': 'Linux/UNIX', 'UsageOperation': 'RunInstances', 'UsageOperationUpdateTime': datetime.datetime(2021, 11, 21, 10, 51, 22, tzinfo=tzutc())}]

        self.response_list = [first_instance, second_instance]
        self.assertEqual(str(get_all_aws_instances(specific_regions=active_regions)), expected_instances)


if __name__ == '__main__':
    # Runs the unittest.main func if the file has been executed.
    main()



